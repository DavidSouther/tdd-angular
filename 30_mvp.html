<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="scripts.js"></script>
</head>

<body>
<div class="container"><div class="row">

<div class="col-md-8 col-md-offset-1">
	<h1><a href="http://www.obeythetestinggoat.com/">Obey the Testing Goat</a> <small><a href="https://github.com/DavidSouther/tdd-angular">NodeJS edition!</a></small></h1>

	<h2>Getting an MVP</h2>

	<p class="lead">With the testing framework in place, it's time to iterate from almost nothing to a usuable minimum product.</p>
</div>

<div class="col-md-8 col-md-offset-2">
	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/b92ecf">b92ecf</a></span>  Added karma coverage.</h3>

		<pre>
			<span class="nrm">.gitignore       | 1 </span><span class="add">+</span>
			<span class="nrm">Gruntfile.coffee | 7 </span><span class="add">+++++++</span>
			<span class="nrm">package.json     | 3 </span><span class="add">++</span><span class="rem">-</span>
			<span class="nrm">3 files changed, 10 insertions(+), 1 deletion(-)</span>
		</pre>

		<p>Before going too far, this is a good time to add Karma test coverage. Just require the reporter and add the grunt config. Slick. (Still need to find somethig as easy for mocha tests.</p>

		<pre>
			<span class="wrn">diff --git a/Gruntfile.coffee b/Gruntfile.coffee</span>
			<span class="nfo">@@ -14,6 +14,13 @@</span> module.exports = (grunt)-&gt;
			<span class="nrm">				options:</span>
			<span class="nrm">					browsers: [&quot;PhantomJS&quot;]</span>
			<span class="nrm">					frameworks: [&quot;jasmine&quot;]</span>
			<span class="add">+					preprocessors:</span>
			<span class="add">+						&quot;src/client/bundle.js&quot;: &quot;coverage&quot;</span>
			<span class="add">+						&quot;src/**/*.coffee&quot;: &quot;coffee&quot;</span>
			<span class="add">+					reporters: [</span>
			<span class="add">+						'coverage'</span>
			<span class="add">+						'dots'</span>
			<span class="add">+					]</span>
			<span class="nrm">					singleRun: true</span>
			<span class="nrm">					files: [</span>
			<span class="nrm">						&quot;bower_components/angular/angular.js&quot;</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/b251505">b251505</a></span>  Implemented auto local save.</h3>

		<pre>
			<span class="nrm">src/client/todo/module.coffee |  9 </span><span class="add">+++++++</span><span class="rem">--</span>
			<span class="nrm">src/client/todo/unit.coffee   | 28 </span><span class="add">+++++++++++++++++++++++</span><span class="rem">-----</span>
			<span class="nrm">2 files changed, 30 insertions(+), 7 deletions(-)</span>

		</pre>

		<p>After finishing implementing tests for checking if the user's data was saved, it's time to implement said save functionality. We use html5 localstorage here. Remember that localstorage is string:string key/value pairs only, so it's the client's responsibilty to handle serialization.</p>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/unit.coffee b/src/client/todo/unit.coffee</span>
			<span class="nfo">@@ -1,10 +1,12 @@</span>
			<span class="add">+$scope = null</span>
			<span class="add">+loadScope = inject ($rootScope, $controller)-&gt;</span>
			<span class="add">+	$scope = $rootScope.$new()</span>
			<span class="add">+	$controller &quot;todo&quot;, {$scope}</span>
			<span class="add">+</span>
			<span class="nrm">describe &quot;todo controller&quot;, -&gt;</span>
			<span class="nrm">	beforeEach module &quot;todo&quot;</span>
			<span class="rem">-</span>
			<span class="rem">-	$scope = null</span>
			<span class="rem">-	beforeEach inject ($rootScope, $controller)-&gt;</span>
			<span class="rem">-		$scope = $rootScope.$new()</span>
			<span class="rem">-		$controller &quot;todo&quot;, {$scope}</span>
			<span class="add">+	beforeEach loadScope</span>
			<span class="add">+	afterEach -&gt; delete window.localStorage['TDD-ToDos']</span>
			<span class="nrm"></span>
			<span class="nrm">it &quot;exposes todos&quot;, -&gt;</span>
			<span class="nrm">		expect($scope.todos).toEqual([], &quot;todos should be array&quot;)</span>
			<span class="nfo">@@ -18,3 +20,19 @@</span> describe &quot;todo controller&quot;, -&gt;
			<span class="nrm">		expect($scope.todos.length).toEqual(1, &quot;After adding, todos has single todo&quot;)</span>
			<span class="nrm">		expect($scope.todos[0]).toEqual(&quot;Todo 1&quot;, &quot;Correct Todo was added&quot;)</span>
			<span class="nrm">		expect($scope.Todos.current).toEqual(&quot;&quot;, &quot;Resets current todo&quot;)</span>
			<span class="add">+</span>
			<span class="add">+	describe &quot;localStorage&quot;, -&gt;</span>
			<span class="add">+		it &quot;saves to local storage&quot;, -&gt;</span>
			<span class="add">+			$scope.Todos.current = &quot;Todo 1&quot;</span>
			<span class="add">+			$scope.Todos.add()</span>
			<span class="add">+			expect(window.localStorage['TDD-ToDos']).toBeDefined(&quot;TDD-ToDos were created on localStorage&quot;)</span>
			<span class="add">+			stored = window.localStorage['TDD-ToDos']</span>
			<span class="add">+			expect(stored).toEqual('[&quot;Todo 1&quot;]', &quot;Saves array of todos&quot;)</span>
			<span class="add">+</span>
			<span class="add">+		describe &quot;load&quot;, -&gt;</span>
			<span class="add">+			beforeEach -&gt;</span>
			<span class="add">+				window.localStorage['TDD-ToDos'] = '[&quot;Todo 1&quot;]'</span>
			<span class="add">+				loadScope()</span>
			<span class="add">+</span>
			<span class="add">+			it &quot;restores from local storage&quot;, -&gt;</span>
			<span class="add">+				expect($scope.todos).toEqual([&quot;Todo 1&quot;], &quot;Loaded one saved todo&quot;)</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/module.coffee b/src/client/todo/module.coffee</span>
			<span class="nfo">@@ -1,9 +1,14 @@</span>
			<span class="nrm">module.exports = todo = angular.module &quot;todo&quot;, []</span>

			<span class="rem">-todo.controller &quot;todo&quot;, ($scope)-&gt;</span>
			<span class="rem">-	$scope.todos = []</span>
			<span class="add">+todo.service &quot;storage&quot;, -&gt;</span>
			<span class="add">+	get: -&gt; JSON.parse window.localStorage[&quot;TDD-ToDos&quot;] || '[]'</span>
			<span class="add">+	set: (TDs)-&gt; window.localStorage[&quot;TDD-ToDos&quot;] = JSON.stringify TDs</span>
			<span class="add">+</span>
			<span class="add">+todo.controller &quot;todo&quot;, ($scope, storage)-&gt;</span>
			<span class="add">+	$scope.todos = storage.get()</span>
			<span class="nrm">	Todos = $scope.Todos =</span>
			<span class="nrm">		current: &quot;&quot;</span>
			<span class="nrm">		add: -&gt;</span>
			<span class="nrm">			$scope.todos.push Todos.current</span>
			<span class="nrm">			Todos.current = &quot;&quot;</span>
			<span class="add">+			storage.set $scope.todos</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/def81c4">def81c4</a></span>  Switched to jade for index</h3>

		<pre>
			<span class="nrm">.gitignore                    |  1 </span><span class="add">+</span>
			<span class="nrm">Gruntfile.coffee              |  7 </span><span class="add">+++++++</span>
			<span class="nrm">package.json                  |  3 </span><span class="add">++</span><span class="rem">-</span>
			<span class="nrm">src/client/.gitignore         |  1 </span><span class="rem">-</span>
			<span class="nrm">src/client/index.html         | 20 </span><span class="rem">--------------------</span>
			<span class="nrm">src/client/index.jade         | 14 </span><span class="add">++++++++++++++</span>
			<span class="nrm">src/server/server.coffee      |  2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">src/server/test/serves.coffee |  2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">8 files changed, 26 insertions(+), 24 deletions(-)</span>
		</pre>

		<p>You may have noticed I like transpiled languages. If you didn't, let me tell you, I like transpiled languages. HTML is a pain in the ass to write, so markdown takes out all the pain of formatting text/plain. It's not quite enough for representing DOM. Jade fills the gap beautifully. It's clean, elegant, and a pleasure to use. If you've been on board with me for Coffee and Markdown, you will enjoy Jade.</p>

		<pre>
			<span class="wrn">diff --git a/src/client/index.jade b/src/client/index.jade</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,14 @@</span>
			<span class="add">+!!!</span>
			<span class="add">+html</span>
			<span class="add">+	head</span>
			<span class="add">+		title To Do - Angular JS</span>
			<span class="add">+		script(src='bower/angular/angular.js')</span>
			<span class="add">+		script(src='bundle.js')</span>
			<span class="add">+	body(ng:app='todo')</span>
			<span class="add">+		header</span>
			<span class="add">+			h1 To Do</span>
			<span class="add">+		section(ng:controller='todo')</span>
			<span class="add">+			form(ng:submit='Todos.add()')</span>
			<span class="add">+				input(type='text', name='to-do', placeholder='to-do', ng:model='Todos.current')</span>
			<span class="add">+			ol(ng:cloak='ng:cloak')</span>
			<span class="add">+				li(ng:repeat='todo in todos') {{todo}}</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/server/test/serves.coffee b/src/server/test/serves.coffee</span>
			<span class="nfo">@@ -29,7 +29,7 @@</span> describe &quot;Server&quot;, -&gt;
			<span class="nrm"></span>
			<span class="nrm">	it &quot;returns an index page at /&quot;, (done)-&gt;</span>
			<span class="nrm">			index done, (e, r, body)-&gt;</span>
			<span class="rem">-				body.should.match /^&lt;html&gt;/</span>
			<span class="add">+				body.should.match /^&lt;!DOCTYPE html&gt;&lt;html&gt;/</span>
			<span class="nrm">				body.should.match /&lt;\/html&gt;$/</span>
			<span class="nrm"></span>
			<span class="nrm">describe &quot;index.html&quot;, -&gt;</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/03cb4ad">03cb4ad</a></span>  Added Jason user - who likes using pretty software.</h3>

		<pre>
			<span class="nrm">src/features/behavior/users/jason/Jason.feature | 11 </span><span class="add">+++++++++++</span>
			<span class="nrm">1 file changed, 11 insertions(+)</span>
		</pre>

		<p>Testing the stylistics of user interfaces is hard, and exploring that type of testing is somewhat uncharted territory. In this first attempt, we only check that a couple elements are somewhere relatively close to the center of the page. This topic will get revisited in the future.</p>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/users/jason/Jason.feature b/src/features/behavior/users/jason/Jason.feature</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,11 @@</span>
			<span class="add">+@current</span>
			<span class="add">+Feature: Site looks nice</span>
			<span class="add">+	As a user of our side</span>
			<span class="add">+	Jason wants the site to be pleasant to use</span>
			<span class="add">+	So that he has an exceptional experience</span>
			<span class="add">+</span>
			<span class="add">+	Scenario: basic styling</span>
			<span class="add">+		Given Jason has his browser open</span>
			<span class="add">+		When he visits the site</span>
			<span class="add">+		Then the &quot;header&quot; is centered</span>
			<span class="add">+		And the &quot;input&quot; is centered</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/92f29e2">92f29e2</a></span>  Added steps and support for checking if an item is &quot;centered&quot;.</h3>

		<pre>
			<span class="nrm">src/features/behavior/steps/browsing.coffee        |  4 </span><span class="add">+</span><span class="rem">--</span>
			<span class="nrm">src/features/behavior/steps/stylistic.coffee       | 30 </span><span class="add">++++++++++++++++++++++</span>
			<span class="nrm">src/features/behavior/support/worlds.coffee        |  8 </span><span class="add">+++++</span><span class="rem">-</span>
			<span class="nrm">.../behavior/support/worlds/protractor.coffee      | 16 </span><span class="add">++++++++++++</span>
			<span class="nrm">4 files changed, 55 insertions(+), 3 deletions(-)</span>

		</pre>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/steps/browsing.coffee b/src/features/behavior/steps/browsing.coffee</span>
			<span class="nfo">@@ -4,7 +4,7 @@</span> World = require &quot;../support/worlds&quot;
			<span class="nrm">module.exports = -&gt;</span>
			<span class="nrm">	@Before (done)-&gt;</span>
			<span class="nrm">		# opening a browser is like entering a whole new world...</span>
			<span class="rem">-		@world = new World()</span>
			<span class="add">+		@world = World.get()</span>
			<span class="nrm">		done()</span>
			<span class="nrm"></span>
			<span class="nrm">@After (done)-&gt;</span>
			<span class="nfo">@@ -20,7 +20,7 @@</span> module.exports = -&gt;
			<span class="nrm">		.then(=&gt;done())</span>
			<span class="nrm">		.catch(done)</span>
			<span class="nrm"></span>
			<span class="rem">-	@Given /(?:on|goes to) the (?:site|landing page)(?: directly)?/, (done)-&gt;</span>
			<span class="add">+	@Given /(?:on|goes to|visits) the (?:site|landing page)(?: directly)?/, (done)-&gt;</span>
			<span class="nrm">		@world.visit(&quot;http://localhost:3000/&quot;)</span>
			<span class="nrm">		.then(done)</span>
		</pre>


		<pre>
			<span class="wrn">diff --git a/src/features/behavior/steps/stylistic.coffee b/src/features/behavior/steps/stylistic.coffee</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,30 @@</span>
			<span class="add">+Q = require 'q'</span>
			<span class="add">+should = require &quot;should&quot;</span>
			<span class="add">+World = require &quot;../support/worlds&quot;</span>
			<span class="add">+</span>
			<span class="add">+module.exports = -&gt;</span>
			<span class="add">+	###</span>
			<span class="add">+	Check for bootstap on the page...</span>
			<span class="add">+	####</span>
			<span class="add">+	@Then /^bootstrap is loaded$/, (done)-&gt;</span>
			<span class="add">+		done() # No idea how to test this...</span>
			<span class="add">+</span>
			<span class="add">+	###</span>
			<span class="add">+	Verify an element is &quot;centered&quot;</span>
			<span class="add">+	###</span>
			<span class="add">+	@Then /the &quot;([^&quot;]+)&quot; is centered/, (elem, done)-&gt;</span>
			<span class="add">+		@world.coords(elem)</span>
			<span class="add">+		.then (coords)-&gt;</span>
			<span class="add">+			# The expected position is how far &quot;left&quot; the element should be</span>
			<span class="add">+			# This is a numerically quick way to calculate</span>
			<span class="add">+			expected = (coords.window.width - coords.element.width) / 2</span>
			<span class="add">+			actual = coords.element.left</span>
			<span class="add">+			absolute = Math.abs(actual - expected)</span>
			<span class="add">+			# The tolerance for positioning is some percentage of the window width,</span>
			<span class="add">+			# in this case 5%</span>
			<span class="add">+			tolerance = 0.05 * coords.window.width</span>
			<span class="add">+			# The error should be less than some tolerance</span>
			<span class="add">+			absolute.should.be.lessThan tolerance, &quot;centering #{elem}&quot;</span>
			<span class="add">+		.then(-&gt;done())</span>
			<span class="add">+		.catch(done)</span>
			<span class="add">+</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/support/worlds/protractor.coffee b/src/features/behavior/support/worlds/protractor.coffee</span>
			<span class="nfo">@@ -4,6 +4,7 @@</span> webdriver = require &quot;selenium-webdriver&quot;
			<span class="nrm">Protractor = require &quot;protractor&quot;</span>
			<span class="nrm">By = Protractor.By</span>

			<span class="add">+_destroyed = false</span>
			<span class="nrm">module.exports = class World</span>
			<span class="nrm">	constructor: -&gt;</span>
			<span class="nrm">		@driver = new webdriver.Builder().</span>
			<span class="nfo">@@ -39,5 +40,20 @@</span> module.exports = class World
			<span class="nrm">				input.submit()</span>
			<span class="nrm">		Q deferred</span>

			<span class="add">+	coords: (elem)-&gt;</span>
			<span class="add">+		Q.all([</span>
			<span class="add">+			@find('html').getSize()</span>
			<span class="add">+			@find( elem ).getLocation()</span>
			<span class="add">+			@find( elem ).getSize()</span>
			<span class="add">+		]).spread (window, location, size)-&gt;</span>
			<span class="add">+			coords =</span>
			<span class="add">+				window: window</span>
			<span class="add">+				element:</span>
			<span class="add">+					width: size.width</span>
			<span class="add">+					left: location.x</span>
			<span class="add">+</span>
			<span class="nrm">	destroy: (done)-&gt;</span>
			<span class="add">+		_destroyed = true</span>
			<span class="nrm">		@driver.quit()</span>
			<span class="add">+</span>
			<span class="add">+	isDestroyed: -&gt; _destroyed</span>
		</pre>

		<p>The actual test is a bit of math, which takes the shortcut of cheking the left side of the element under question, instead of doing two divisions for the midpoint. The world has some Q deferreds to tippy toe around getting three seperate async operations to coalesce into a single result.</p>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/51b7c4a">51b7c4a</a></span>  Added bootstrap and styling.</h3>

		<pre>
			<span class="nrm">Gruntfile.coffee              | 43 </span><span class="add">+++++++++++++++++++++++++++++++++++++++</span><span class="rem">----</span>
			<span class="nrm">bower.json                    | 10 </span><span class="add">++++++++</span><span class="rem">--</span>
			<span class="nrm">package.json                  |  3 </span><span class="add">++</span><span class="rem">-</span>
			<span class="nrm">src/client/index.jade         | 19 </span><span class="add">++++++++++++</span><span class="rem">-------</span>
			<span class="nrm">src/client/page.less          |  8 </span><span class="add">++++++++</span>
			<span class="nrm">src/server/server.coffee      |  4 </span><span class="add">++++</span>
			<span class="nrm">src/server/test/serves.coffee | 15 </span><span class="add">++++++++++++++</span><span class="rem">-</span>
			<span class="nrm">7 files changed, 87 insertions(+), 15 deletions(-)</span>
		</pre>

		<p>Bootstrap is the new jQuery UI. It's certainly cleaner and more modern than jquery ui, and works great for projects like this. After the rave for Jade a couple commits ago, using a CSS transpiler is unsurprising. I personally prefer the syntax of Stylus, but alas, Bootstrap is Less, and if I wanted to configure it (which I will in future projects), less is more.</p>

		<pre>
			<span class="wrn">diff --git a/Gruntfile.coffee b/Gruntfile.coffee</span>
			<span class="nfo">@@ -14,6 +14,15 @@</span> module.exports = (grunt)-&gt;
			<span class="nrm">				files:</span>
			<span class="nrm">					&quot;build/index.html&quot;: &quot;src/client/index.jade&quot;</span>
			<span class="nrm"></span>
			<span class="add">+		less:</span>
			<span class="add">+			page:</span>
			<span class="add">+				options:</span>
			<span class="add">+					paths:[</span>
			<span class="add">+						&quot;bower_components/bootstrap/less&quot;</span>
			<span class="add">+					]</span>
			<span class="add">+				files:</span>
			<span class="add">+					&quot;build/page.css&quot;: [&quot;src/client/page.less&quot;]</span>
			<span class="add">+</span>
			<span class="nrm">		karma:</span>
			<span class="nrm">			unit:</span>
			<span class="nrm">				options:</span>
			<span class="nfo">@@ -60,18 +69,32 @@</span> module.exports = (grunt)-&gt;
			<span class="nrm">					&quot;sleep 1&quot;</span>
			<span class="nrm"></span>
			<span class="nrm">	cucumberjs:</span>
			<span class="rem">-			users:</span>
			<span class="rem">-				files: src: ['src/features/behavior/users/*']</span>
			<span class="add">+			all:</span>
			<span class="add">+				files:</span>
			<span class="add">+					src: ['src/features/behavior/users/*']</span>
			<span class="add">+			current:</span>
			<span class="add">+				files:</span>
			<span class="add">+					src: ['src/features/behavior/users/*']</span>
			<span class="add">+				options:</span>
			<span class="add">+					tags: '@current'</span>
			<span class="add">+</span>
			<span class="nrm">			options:</span>
			<span class="nrm">				steps: 'src/features/behavior/steps'</span>
			<span class="nrm"></span>
			<span class="nrm">	watch:</span>
			<span class="nrm">			all:</span>
			<span class="nrm">				files: [</span>
			<span class="nrm">					'src/features/**/*coffee'</span>
			<span class="nrm">					'src/features/**/*feature'</span>
			<span class="nrm">					'src/server/**/*coffee'</span>
			<span class="rem">-					'src/client/**/*html'</span>
			<span class="add">+					'src/client/**/*jade'</span>
			<span class="nrm">					'src/client/**/*coffee'</span>
			<span class="nrm">					'src/client/**/*less'</span>
			<span class="nrm">				]</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/index.jade b/src/client/index.jade</span>
			<span class="nfo">@@ -2,13 +2,18 @@</span>
			<span class="nrm">html</span>
			<span class="nrm">	head</span>
			<span class="nrm">		title To Do - Angular JS</span>
			<span class="add">+		meta(name=&quot;viewport&quot;, content=&quot;width=device-width, initial-scale=1.0&quot;)</span>
			<span class="add">+		link(rel=&quot;stylesheet&quot;, href=&quot;page.css&quot;, media=&quot;screen&quot;)</span>
			<span class="nrm">		script(src='bower/angular/angular.js')</span>
			<span class="nrm">		script(src='bundle.js')</span>
			<span class="nrm">	body(ng:app='todo')</span>
			<span class="rem">-		header</span>
			<span class="rem">-			h1 To Do</span>
			<span class="rem">-		section(ng:controller='todo')</span>
			<span class="rem">-			form(ng:submit='Todos.add()')</span>
			<span class="rem">-				input(type='text', name='to-do', placeholder='to-do', ng:model='Todos.current')</span>
			<span class="rem">-			ol(ng:cloak='ng:cloak')</span>
			<span class="rem">-				li(ng:repeat='todo in todos') {{todo}}</span>
			<span class="add">+		.container</span>
			<span class="add">+			.jumbotron</span>
			<span class="add">+				header</span>
			<span class="add">+					h1 To Do</span>
			<span class="add">+				section.row(ng:controller='todo')</span>
			<span class="add">+					.col-md-6.col-md-offset-3</span>
			<span class="add">+						form(ng:submit='Todos.add()')</span>
			<span class="add">+							input(type='text', id=&quot;to-do&quot;, name='to-do', placeholder='to-do', ng:model='Todos.current')</span>
			<span class="add">+						ol(ng:cloak='ng:cloak')</span>
			<span class="add">+							li(ng:repeat='todo in todos') {{todo}}</span>
		</pre>


		<pre>
			<span class="wrn">diff --git a/src/client/page.less b/src/client/page.less</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,8 @@</span>
			<span class="add">+@import &quot;bootstrap.less&quot;;</span>
			<span class="add">+</span>
			<span class="add">+#to-do {</span>
			<span class="add">+    font-size: larger;</span>
			<span class="add">+    padding: 10px;</span>
			<span class="add">+    margin-top: 2ex;</span>
			<span class="add">+    width: 100%;</span>
			<span class="add">+}</span>
		</pre>


		<pre>
			<span class="wrn">diff --git a/src/server/server.coffee b/src/server/server.coffee</span>
			<span class="nfo">@@ -4,6 +4,10 @@</span> app = express()
			<span class="nrm"></span>
			<span class="nrm">root = path.join __dirname, &quot;..&quot;, &quot;..&quot;</span>
			<span class="nrm"></span>
			<span class="add">+app.get '/page.css', (req, res)-&gt;</span>
			<span class="add">+	res.set &quot;content-type&quot;, &quot;text/css&quot;</span>
			<span class="add">+	res.sendfile path.join root, &quot;build&quot;, &quot;page.css&quot;</span>
			<span class="add">+</span>
			<span class="nrm">app.get '/bundle.js', (req, res)-&gt;</span>
			<span class="nrm">	res.set &quot;content-type&quot;, &quot;text/javascript&quot;</span>
			<span class="nrm">	res.sendfile path.join root, &quot;build&quot;, &quot;bundle.js&quot;</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/server/test/serves.coffee b/src/server/test/serves.coffee</span>
			<span class="nfo">@@ -7,8 +7,9 @@</span> get = (path, d, cb)-&gt;
			<span class="nrm">		cb e, r, b</span>
			<span class="nrm">		d()</span>
			<span class="nrm"></span>
			<span class="rem">-index = (d, cb)-&gt; get &quot;http://localhost:3000/&quot;, d, cb</span>
			<span class="add">+index  = (d, cb)-&gt; get &quot;http://localhost:3000/&quot;, d, cb</span>
			<span class="nrm">bundle = (d, cb)-&gt; get &quot;http://localhost:3000/bundle.js&quot;, d, cb</span>
			<span class="add">+styles = (d, cb)-&gt; get &quot;http://localhost:3000/page.css&quot;, d, cb</span>
			<span class="nrm"></span>
			<span class="nrm">Callbacks =</span>
			<span class="nrm">	OK: (e, res)-&gt;</span>
			<span class="nfo">@@ -55,6 +56,10 @@</span> describe &quot;Server&quot;, -&gt;
			<span class="nrm">				should.exist matches</span>
			<span class="nrm">				matches[1].should.match /to-do/</span>
			<span class="nrm"></span>
			<span class="add">+		it &quot;sets a viewport&quot;, (done)-&gt;</span>
			<span class="add">+			index done, (e, r, body)-&gt;</span>
			<span class="add">+				body.should.match /&lt;meta[^&gt;]+name=&quot;viewport&quot;/</span>
			<span class="add">+</span>
			<span class="nrm">	describe &quot;bundle.js&quot;, -&gt;</span>
			<span class="nrm">		it &quot;returns a bundle&quot;, (done)-&gt;</span>
			<span class="nrm">			bundle done, Callbacks.OK</span>
			<span class="nfo">@@ -69,6 +74,14 @@</span> describe &quot;Server&quot;, -&gt;
			<span class="nrm">					angular\.module\(&quot;todo&quot;</span>
			<span class="nrm">				///</span>
			<span class="nrm"></span>
			<span class="add">+	describe &quot;page.css&quot;, -&gt;</span>
			<span class="add">+		it &quot;returns a stylesheet&quot;, (done)-&gt;</span>
			<span class="add">+			styles done, Callbacks.OK</span>
			<span class="add">+</span>
			<span class="add">+		it &quot;returns a css bundle&quot;, (done)-&gt;</span>
			<span class="add">+			styles done, (e, res)-&gt;</span>
			<span class="add">+				res.headers[&quot;content-type&quot;].should.equal &quot;text/css&quot;</span>
			<span class="add">+</span>
			<span class="nrm">	describe &quot;bower&quot;, -&gt;</span>
			<span class="nrm">		it &quot;serves Bower resources&quot;, (done)-&gt;</span>
			<span class="nrm">			request &quot;http://localhost:3000/bower/angular/angular.js&quot;, (e, res)-&gt;</span>
		</pre>

		<p>At this point, I really don't know how to test Bootstrap, except checking for a couple sentinal values - is the viewport set? Is page.css returned? Any thoughts would be greatly appreciated.</p>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/d943312">d943312</a></span>  Allow server start to get configuration settings.</h3>

		<pre>
			<span class="nrm">package.json                |  3 </span><span class="add">++</span><span class="rem">-</span>
			<span class="nrm">src/server/server.coffee    | 21 </span><span class="add">++++++++++++++++</span><span class="rem">-----</span>
			<span class="nrm">src/server/test/port.coffee | 34 </span><span class="add">++++++++++++++++++++++++++++++++++</span>
			<span class="nrm">3 files changed, 52 insertions(+), 6 deletions(-)</span>
		</pre>

		<p>The app is starting to come together very nicely, so it's time to refactor and add a couple features to the server we'll need for deployment, especially configuring the listening port.</p>

		<pre>
			<span class="wrn">diff --git a/src/server/server.coffee b/src/server/server.coffee</span>
			<span class="nfo">@@ -1,9 +1,16 @@</span>
			<span class="nrm">path = require &quot;path&quot;</span>
			<span class="rem">-express = require &quot;express&quot;</span>
			<span class="rem">-app = express()</span>
			<span class="rem">-</span>
			<span class="nrm">root = path.join __dirname, &quot;..&quot;, &quot;..&quot;</span>

			<span class="add">+nconf = require &quot;nconf&quot;</span>
			<span class="add">+nconf.argv()</span>
			<span class="add">+	.env()</span>
			<span class="add">+	.file</span>
			<span class="add">+		file: path.join root, 'server.json'</span>
			<span class="add">+	.defaults</span>
			<span class="add">+		port: 3000</span>
			<span class="add">+</span>
			<span class="add">+express = require &quot;express&quot;</span>
			<span class="add">+app = express()</span>
			<span class="nrm">app.get '/page.css', (req, res)-&gt;</span>
			<span class="nrm">	res.set &quot;content-type&quot;, &quot;text/css&quot;</span>
			<span class="nrm">	res.sendfile path.join root, &quot;build&quot;, &quot;page.css&quot;</span>
			<span class="nfo">@@ -19,6 +26,10 @@</span> app.get '/bower/:module/:file', (req, res)-&gt;
			<span class="nrm">app.get '/', (req, res)-&gt;</span>
			<span class="nrm">	res.sendfile path.join root, &quot;build&quot;, &quot;index.html&quot;</span>

			<span class="rem">-module.exports =</span>
			<span class="add">+module.exports = do -&gt;</span>
			<span class="nrm">	serve: -&gt;</span>
			<span class="rem">-		app.listen(3000)</span>
			<span class="add">+		port = nconf.get('port')</span>
			<span class="add">+		server = app.listen port</span>
			<span class="add">+		console.log &quot;ToDo Application Server listening on port #{port}&quot;</span>
			<span class="add">+	stop: -&gt;</span>
			<span class="add">+		server?.close()</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/server/test/port.coffee b/src/server/test/port.coffee</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,34 @@</span>
			<span class="add">+nconf = require &quot;nconf&quot;</span>
			<span class="add">+should = require &quot;should&quot;</span>
			<span class="add">+server = require &quot;../server&quot;</span>
			<span class="add">+request = require &quot;request&quot;</span>
			<span class="add">+</span>
			<span class="add">+get = (path, d, cb)-&gt;</span>
			<span class="add">+	request path, (e, r, b)-&gt;</span>
			<span class="add">+		cb e, r, b</span>
			<span class="add">+		d()</span>
			<span class="add">+</span>
			<span class="add">+port = 3030</span>
			<span class="add">+</span>
			<span class="add">+index  = (d, cb)-&gt; get &quot;http://localhost:#{port}/&quot;, d, cb</span>
			<span class="add">+Callbacks =</span>
			<span class="add">+	OK: (e, res)-&gt;</span>
			<span class="add">+		res.statusCode.should.equal 200</span>
			<span class="add">+</span>
			<span class="add">+describe &quot;Server&quot;, -&gt;</span>
			<span class="add">+	_port = undefined</span>
			<span class="add">+</span>
			<span class="add">+	before -&gt;</span>
			<span class="add">+		_port = nconf.get &quot;port&quot;</span>
			<span class="add">+		nconf.set &quot;port&quot;, 3030</span>
			<span class="add">+		server.serve()</span>
			<span class="add">+</span>
			<span class="add">+	after -&gt;</span>
			<span class="add">+		server.stop()</span>
			<span class="add">+		nconf.set &quot;port&quot;, _port</span>
			<span class="add">+		_port = undefined</span>
			<span class="add">+</span>
			<span class="add">+	describe &quot;/&quot;, -&gt;</span>
			<span class="add">+		it &quot;binds on a known port&quot;, (done)-&gt;</span>
			<span class="add">+			index done, (err, response)-&gt;</span>
			<span class="add">+				should.not.exist err, &quot;Error when GETting (#{err})&quot;</span>

		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/cdc377d">cdc377d</a></span>  Added feature for Edith removing an item</h3>

		<pre>
			<span class="nrm">src/features/behavior/steps/browsing.coffee     | 10 </span><span class="add">++++++++++</span>
			<span class="nrm">src/features/behavior/steps/todo.coffee         | 10 </span><span class="add">++++++++++</span>
			<span class="nrm">src/features/behavior/users/edith/Edith.feature | 12 </span><span class="add">++++++++++++</span>
			<span class="nrm">src/features/behavior/users/jason/Jason.feature |  1 </span><span class="rem">-</span>
			<span class="nrm">4 files changed, 32 insertions(+), 1 deletion(-)</span>
		</pre>


		<p>Still don't have the removing items feature for the MVP. I think it's pretty useless to have a todo list that I can't finish anything on, so here's the tests for implementing that.</p>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/users/edith/Edith.feature b/src/features/behavior/users/edith/Edith.feature</span>
			<span class="nfo">@@ -36,6 +36,18 @@</span> Feature: Site loads
			<span class="nrm">		And the page shows &quot;Use peacock feathers to make a fly&quot;</span>
			<span class="nrm">		And she should be invited to enter another &quot;to-do&quot; item</span>

			<span class="add">+	@current</span>
			<span class="add">+	Scenario: Finishes a todo</span>
			<span class="add">+		Given Edith is on the landing page</span>
			<span class="add">+		And she enters into a &quot;to-do&quot; box</span>
			<span class="add">+			&quot;&quot;&quot;</span>
			<span class="add">+			Buy peacock feathers</span>
			<span class="add">+			Use peacock feathers to make a fly</span>
			<span class="add">+			&quot;&quot;&quot;</span>
			<span class="add">+		When she removes the first todo</span>
			<span class="add">+		Then the page does not show &quot;Buy peacock feathers&quot;</span>
			<span class="add">+		And the page shows &quot;Use peacock feathers to make a fly&quot;</span>
			<span class="add">+</span>
			<span class="nrm">	# Edith wonders whether the site will remember her list. Then she sees</span>
			<span class="nrm">	# that the site has generated a unique URL for her -- there is some</span>
			<span class="nrm">	# explanatory text to that effect.</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/steps/todo.coffee b/src/features/behavior/steps/todo.coffee</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,10 @@</span>
			<span class="add">+Q = require 'q'</span>
			<span class="add">+should = require &quot;should&quot;</span>
			<span class="add">+module.exports = -&gt;</span>
			<span class="add">+	@When /remove(?:s?) the first todo/, (what, done)-&gt;</span>
			<span class="add">+		@world.click(&quot;.remove:nth-of-type(1)&quot;)</span>
			<span class="add">+		.then -&gt;</span>
			<span class="add">+			debugger;</span>
			<span class="add">+			done()</span>
			<span class="add">+		# .catch (e)-&gt;</span>
			<span class="add">+		# 	done(e)</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/steps/browsing.coffee b/src/features/behavior/steps/browsing.coffee</span>
			<span class="nfo">@@ -75,3 +75,13 @@</span> module.exports = -&gt;
			<span class="nrm">			text.should.match ///#{content}///</span>
			<span class="nrm">			done()</span>
			<span class="nrm">		.catch done</span>
			<span class="add">+</span>
			<span class="add">+	###</span>
			<span class="add">+	Ensure lack of content in the body.</span>
			<span class="add">+	###</span>
			<span class="add">+	@Then /page does not show &quot;([^&quot;]+)&quot;/, (content, done)-&gt;</span>
			<span class="add">+		@world.text(&quot;body&quot;)</span>
			<span class="add">+		.then (text)-&gt;</span>
			<span class="add">+			text.should.not.match ///#{content}///</span>
			<span class="add">+			done()</span>
			<span class="add">+		.catch done</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/be5bc5a">be5bc5a</a></span>  Implemented removing todos.</h3>

		<pre>
			<span class="nrm">src/client/todo/module.coffee | 2 </span><span class="add">++</span>
			<span class="nrm">src/client/todo/style.less    | 4 </span><span class="add">++++</span>
			<span class="nrm">src/client/todo/template.jade | 7 </span><span class="add">+++++</span><span class="rem">--</span>
			<span class="nrm">src/client/todo/unit.coffee   | 8 </span><span class="add">++++++++</span>
			<span class="nrm">4 files changed, 19 insertions(+), 2 deletions(-)</span>

		</pre>

		<p>With the behaviors in place, time to implement the removal in the Angular code. First the tests, then the implementation.</p>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/unit.coffee b/src/client/todo/unit.coffee</span>
			<span class="nfo">@@ -21,6 +21,14 @@</span> describe &quot;todo controller&quot;, -&gt;
			<span class="nrm">		expect($scope.todos[0]).toEqual(&quot;Todo 1&quot;, &quot;Correct Todo was added&quot;)</span>
			<span class="nrm">		expect($scope.Todos.current).toEqual(&quot;&quot;, &quot;Resets current todo&quot;)</span>
			<span class="add">+	it &quot;can remove todo&quot;, -&gt;</span>
			<span class="add">+		$scope.Todos.current = &quot;Todo 1&quot;</span>
			<span class="add">+		$scope.Todos.add()</span>
			<span class="add">+		$scope.Todos.current = &quot;Todo 2&quot;</span>
			<span class="add">+		$scope.Todos.add()</span>
			<span class="add">+		$scope.Todos.remove(&quot;Todo 1&quot;)</span>
			<span class="add">+		expect($scope.todos).toEqual([&quot;Todo 2&quot;], &quot;One todo left.&quot;)</span>
			<span class="add">+</span>
			<span class="nrm">	describe &quot;localStorage&quot;, -&gt;</span>
			<span class="nrm">		it &quot;saves to local storage&quot;, -&gt;</span>
			<span class="nrm">			$scope.Todos.current = &quot;Todo 1&quot;</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/module.coffee b/src/client/todo/module.coffee</span>
			<span class="nfo">@@ -12,3 +12,5 @@</span> todo.controller &quot;todo&quot;, ($scope, storage)-&gt;
			<span class="nrm">			$scope.todos.push Todos.current</span>
			<span class="nrm">			Todos.current = &quot;&quot;</span>
			<span class="nrm">			storage.set $scope.todos</span>
			<span class="add">+		remove: (todo)-&gt;</span>
			<span class="add">+			$scope.todos.splice $scope.todos.indexOf(todo), 1</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/style.less b/src/client/todo/style.less</span>
			<span class="nfo">@@ -4,3 +4,7 @@</span>
			<span class="nrm"> margin-top: 2ex;</span>
			<span class="nrm"> width: 100%;</span>
			<span class="nrm">}</span>
			<span class="add">+</span>
			<span class="add">+.remove {</span>
			<span class="add">+	margin-top: 2px;</span>
			<span class="add">+}</span>
			<span class="nrm">\ No newline at end of file</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/template.jade b/src/client/todo/template.jade</span>
			<span class="nfo">@@ -4,5 +4,8 @@</span> section.row(ng:controller='todo')
			<span class="nrm">	.col-md-6.col-md-offset-3</span>
			<span class="nrm">		form(ng:submit='Todos.add()')</span>
			<span class="nrm">			input(type='text', id=&quot;to-do&quot;, name='to-do', placeholder='to-do', ng:model='Todos.current')</span>
			<span class="rem">-		ol(ng:cloak='ng:cloak')</span>
			<span class="rem">-			li(ng:repeat='todo in todos') {{todo}}</span>
			<span class="add">+		ol(ng:cloak)</span>
			<span class="add">+			li(ng:repeat='todo in todos')</span>
			<span class="add">+				| {{todo}}</span>
			<span class="add">+				button.remove.btn.btn-default.btn-sm.pull-right(ng:click=&quot;Todos.remove(todo)&quot;)</span>
			<span class="add">+					span.glyphicon.glyphicon-ok</span>
			<span class="nrm">\ No newline at end of file</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/5e20840">5e20840</a></span>  Serve glyphicon font files.</h3>

		<pre>
			<span class="nrm">src/server/server.coffee      | 3 </span><span class="add">+++</span>
			<span class="nrm">src/server/test/serves.coffee | 6 </span><span class="add">++++++</span>
			<span class="nrm">2 files changed, 9 insertions(+)</span>
		</pre>

		<p>What's with all that jumbled markings in the remove button? Turns out Glyphicons are a font family, that we aren't serving any more. That's easy to fix.</p>

		<pre>
			<span class="wrn">diff --git a/src/server/test/serves.coffee b/src/server/test/serves.coffee</span>
			<span class="nfo">@@ -91,3 +91,9 @@</span> describe &quot;Server&quot;, -&gt;
			<span class="nrm">			request &quot;http://localhost:3000/bower/angular/angular.js&quot;, (e, res)-&gt;</span>
			<span class="nrm">				res.statusCode.should.equal 200</span>
			<span class="nrm">				done()</span>
			<span class="add">+</span>
			<span class="add">+	describe &quot;fonts&quot;, -&gt;</span>
			<span class="add">+		it &quot;serves fonts from bootstrap&quot;, (done)-&gt;</span>
			<span class="add">+			request &quot;http://localhost:3000/fonts/glyphicons-halflings-regular.woff&quot;, (e, res)-&gt;</span>
			<span class="add">+				res.statusCode.should.equal 200</span>
			<span class="add">+				done()</span>
			<span class="nrm">\ No newline at end of file</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/server/server.coffee b/src/server/server.coffee</span>
			<span class="nfo">@@ -16,6 +16,9 @@</span> app =
			<span class="nrm">			res.set &quot;content-type&quot;, &quot;text/css&quot;</span>
			<span class="nrm">			res.sendfile path.join root, &quot;build&quot;, &quot;page.css&quot;</span>
			<span class="nrm"></span>
			<span class="add">+		.get '/fonts/:font', (req, res)-&gt;</span>
			<span class="add">+			res.sendfile path.join root, &quot;bower_components&quot;, &quot;bootstrap&quot;, &quot;fonts&quot;, req.params.font</span>
			<span class="add">+</span>
			<span class="nrm">		.get '/bundle.js', (req, res)-&gt;</span>
			<span class="nrm">			res.set &quot;content-type&quot;, &quot;text/javascript&quot;</span>
			<span class="nrm">			res.sendfile path.join root, &quot;build&quot;, &quot;bundle.js&quot;</span>
		</pre>

		<p>At this point, I can use (and have been using) the app to keep track of the list of things I want to do next. That's pretty awesome!</p>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/3548ce3">3548ce3</a></span>  Added test and implementation to save removed items.</h3>

		<pre>
			<span class="nrm">src/client/todo/module.coffee                       |  6 </span><span class="add">+++</span><span class="rem">---</span>
			<span class="nrm">src/features/behavior/steps/todo.coffee             |  9 </span><span class="add">+++</span><span class="rem">------</span>
			<span class="nrm">.../behavior/support/worlds/protractor.coffee       | 16 </span><span class="add">+++++++++</span><span class="rem">-------</span>
			<span class="nrm">src/features/behavior/users/edith/Edith.feature     | 21 </span><span class="add">++++++++++++++++++</span><span class="rem">---</span>
			<span class="nrm">4 files changed, 33 insertions(+), 19 deletions(-)</span>
		</pre>

		<p>And while using the app, I found a bug! It doesn't save the things we've removed! This calls for adding bot unit and behavior tests, to ensure it doesn't regress.</p>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/users/edith/Edith.feature b/src/features/behavior/users/edith/Edith.feature</span>
			<span class="nfo">@@ -48,9 +48,11 @@</span> Feature: Site loads
			<span class="nrm">		Then the page does not show &quot;Buy peacock feathers&quot;</span>
			<span class="nrm">		And the page shows &quot;Use peacock feathers to make a fly&quot;</span>
			<span class="nrm"></span>
			<span class="rem">-	# Edith wonders whether the site will remember her list. Then she sees</span>
			<span class="rem">-	# that the site has generated a unique URL for her -- there is some</span>
			<span class="rem">-	# explanatory text to that effect.</span>
			<span class="add">+Feature: Todo lists save</span>
			<span class="add">+	As a user of our site</span>
			<span class="add">+	Edith wants the site to save her list</span>
			<span class="add">+	So that she can return to a list she made in the past</span>
			<span class="add">+</span>
			<span class="nrm">	Scenario: Saves list</span>
			<span class="nrm">		Given Edith is on the landing page</span>
			<span class="nrm">		And she enters into a &quot;to-do&quot; box</span>
			<span class="nfo">@@ -64,3 +66,16 @@</span> Feature: Site loads
			<span class="nrm">		And the page shows &quot;Use peacock feathers to make a fly&quot;</span>
			<span class="nrm">		And she should be invited to enter another &quot;to-do&quot; item</span>
			<span class="nrm">		# Satisfied, she goes back to sleep</span>
			<span class="add">+</span>
			<span class="add">+	Scenario: Saves list after completing</span>
			<span class="add">+		Given Edith is on the landing page</span>
			<span class="add">+		And she enters into a &quot;to-do&quot; box</span>
			<span class="add">+			&quot;&quot;&quot;</span>
			<span class="add">+			Buy peacock feathers</span>
			<span class="add">+			Use peacock feathers to make a fly</span>
			<span class="add">+			&quot;&quot;&quot;</span>
			<span class="add">+		And she removes the first todo</span>
			<span class="add">+		And she leaves the page</span>
			<span class="add">+		When she goes to the &quot;saved&quot; url</span>
			<span class="add">+		Then the page does not show &quot;Buy peacock feathers&quot;</span>
			<span class="add">+		And the page shows &quot;Use peacock feathers to make a fly&quot;</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/steps/todo.coffee b/src/features/behavior/steps/todo.coffee</span>
			<span class="nfo">@@ -1,10 +1,7 @@</span>
			<span class="nrm">Q = require 'q'</span>
			<span class="nrm">should = require &quot;should&quot;</span>
			<span class="nrm">module.exports = -&gt;</span>
			<span class="rem">-	@When /remove(?:s?) the first todo/, (what, done)-&gt;</span>
			<span class="add">+	@When /remove(?:s?) the first todo/, (done)-&gt;</span>
			<span class="nrm">		@world.click(&quot;.remove:nth-of-type(1)&quot;)</span>
			<span class="rem">-		.then -&gt;</span>
			<span class="rem">-			debugger;</span>
			<span class="rem">-			done()</span>
			<span class="rem">-		# .catch (e)-&gt;</span>
			<span class="rem">-		# 	done(e)</span>
			<span class="add">+		.then -&gt; done()</span>
			<span class="add">+		.catch done</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/support/worlds/protractor.coffee b/src/features/behavior/support/worlds/protractor.coffee</span>
			<span class="nfo">@@ -6,13 +6,13 @@</span> By = Protractor.By
			<span class="nrm">_destroyed = false</span>
			<span class="nrm">module.exports = class World</span>
			<span class="rem">-	constructor: -&gt;</span>
			<span class="add">+	constructor: (browser=&quot;firefox&quot;)-&gt;</span>
			<span class="nrm">		@driver = new webdriver.Builder().</span>
			<span class="nrm">			usingServer('http://localhost:4444/wd/hub').</span>
			<span class="rem">-			withCapabilities(webdriver.Capabilities.firefox()).build();</span>
			<span class="add">+			withCapabilities(webdriver.Capabilities[browser]()).build()</span>
			<span class="nrm">
			<span class="rem">-		@driver.manage().timeouts().setScriptTimeout(10000);</span>
			<span class="rem">-		@ptor = Protractor.wrapDriver(@driver);</span>
			<span class="add">+		@driver.manage().timeouts().setScriptTimeout(100)</span>
			<span class="add">+		@ptor = Protractor.wrapDriver(@driver)</span>
			<span class="nrm"></span>
			<span class="nrm">visit: (url)-&gt;</span>
			<span class="nrm">		Q @ptor.get(url)</span>
			<span class="nfo">@@ -35,9 +35,7 @@</span> module.exports = class World
			<span class="nrm">	fill: (what, value, submit = false)-&gt;</span>
			<span class="nrm">		input = @ptor.findElement(By.name(what))</span>
			<span class="nrm">		deferred = input.sendKeys(value)</span>
			<span class="rem">-		if submit</span>
			<span class="rem">-			deferred.then -&gt;</span>
			<span class="rem">-				input.submit()</span>
			<span class="add">+		input.submit()  if submit</span>
			<span class="nrm">		Q deferred</span>
			<span class="nrm"></span>
			<span class="nrm">coords: (elem)-&gt;</span>
			<span class="nfo">@@ -52,6 +50,10 @@</span> module.exports = class World
			<span class="nrm">					width: size.width</span>
			<span class="nrm">					left: location.x</span>
			<span class="nrm"></span>
			<span class="add">+	click: (what)-&gt;</span>
			<span class="add">+		debugger</span>
			<span class="add">+		Q @find(what).click()</span>
			<span class="add">+</span>
			<span class="nrm">	destroy: (done)-&gt;</span>
			<span class="nrm">		_destroyed = true</span>
			<span class="nrm">		@driver.quit()</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/module.coffee b/src/client/todo/module.coffee</span>
			<span class="nfo">@@ -6,11 +6,11 @@</span> todo.service &quot;storage&quot;, -&gt;
			<span class="nrm">
			<span class="nrm">todo.controller &quot;todo&quot;, ($scope, storage)-&gt;</span>
			<span class="nrm">	$scope.todos = storage.get()</span>
			<span class="add">+	$scope.$watch 'todos', -&gt; storage.set $scope.todos</span>
			<span class="nrm">	Todos = $scope.Todos =</span>
			<span class="nrm">		current: &quot;&quot;</span>
			<span class="rem">-		add: -&gt;</span>
			<span class="add">+		add: -&gt; $scope.$apply -&gt;</span>
			<span class="nrm">			$scope.todos.push Todos.current</span>
			<span class="nrm">			Todos.current = &quot;&quot;</span>
			<span class="rem">-			storage.set $scope.todos</span>
			<span class="rem">-		remove: (todo)-&gt;</span>
			<span class="add">+		remove: (todo)-&gt; $scope.$apply -&gt;</span>
			<span class="nrm">			$scope.todos.splice $scope.todos.indexOf(todo), 1</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/88343d1">88343d1</a></span>  Refactored to save on todos watch.</h3>

		<pre>
			<span class="nrm">src/client/todo/module.coffee | 16 </span><span class="add">+++++++++</span><span class="rem">-------</span>
			<span class="nrm">src/client/todo/unit.coffee   |  3 </span><span class="add">+++</span>
			<span class="nrm">2 files changed, 12 insertions(+), 7 deletions(-)</span>
		</pre>

		<p>That was a relatively large change to the client codebase, and introduced some redundancy. Refactoring that out with an Angular <code>$scope.$watch</code>, and running the tests to verify nothing broke.</p>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/module.coffee b/src/client/todo/module.coffee</span>
			<span class="nfo">@@ -2,15 +2,17 @@</span> module.exports = todo = angular.module &quot;todo&quot;, []
			<span class="nrm">
		todo.service &quot;storage&quot;, -&gt;</span>
			<span class="nrm">	get: -&gt; JSON.parse window.localStorage[&quot;TDD-ToDos&quot;] || '[]'</span>
			<span class="rem">-	set: (TDs)-&gt; window.localStorage[&quot;TDD-ToDos&quot;] = JSON.stringify TDs</span>
			<span class="add">+	put: (TDs)-&gt; window.localStorage[&quot;TDD-ToDos&quot;] = JSON.stringify TDs</span>
			<span class="nrm">
		todo.controller &quot;todo&quot;, ($scope, storage)-&gt;</span>
			<span class="rem">-	$scope.todos = storage.get()</span>
			<span class="rem">-	$scope.$watch 'todos', -&gt; storage.set $scope.todos</span>
			<span class="add">+	todos = $scope.todos = storage.get()</span>
			<span class="add">+	save = (newV, oldV) -&gt;</span>
			<span class="add">+		storage.put todos</span>
			<span class="add">+	$scope.$watch 'todos', save, true</span>
			<span class="nrm">	Todos = $scope.Todos =</span>
			<span class="nrm">		current: &quot;&quot;</span>
			<span class="rem">-		add: -&gt; $scope.$apply -&gt;</span>
			<span class="rem">-			$scope.todos.push Todos.current</span>
			<span class="add">+		add: -&gt;</span>
			<span class="add">+			todos.push Todos.current</span>
			<span class="nrm">			Todos.current = &quot;&quot;</span>
			<span class="rem">-		remove: (todo)-&gt; $scope.$apply -&gt;</span>
			<span class="rem">-			$scope.todos.splice $scope.todos.indexOf(todo), 1</span>
			<span class="add">+		remove: (todo)-&gt;</span>
			<span class="add">+			todos.splice todos.indexOf(todo), 1</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/unit.coffee b/src/client/todo/unit.coffee</span>
			<span class="nfo">@@ -17,6 +17,7 @@</span> describe &quot;todo controller&quot;, -&gt;
			<span class="nrm">	it &quot;can add todo&quot;, -&gt;</span>
			<span class="nrm">		$scope.Todos.current = &quot;Todo 1&quot;</span>
			<span class="nrm">		$scope.Todos.add()</span>
			<span class="add">+		$scope.$digest()</span>
			<span class="nrm">		expect($scope.todos.length).toEqual(1, &quot;After adding, todos has single todo&quot;)</span>
			<span class="nrm">		expect($scope.todos[0]).toEqual(&quot;Todo 1&quot;, &quot;Correct Todo was added&quot;)</span>
			<span class="nrm">		expect($scope.Todos.current).toEqual(&quot;&quot;, &quot;Resets current todo&quot;)</span>
			<span class="nfo">@@ -26,6 +27,7 @@</span> describe &quot;todo controller&quot;, -&gt;
			<span class="nrm">		$scope.Todos.add()</span>
			<span class="nrm">		$scope.Todos.current = &quot;Todo 2&quot;</span>
			<span class="nrm">		$scope.Todos.add()</span>
			<span class="add">+		$scope.$digest()</span>
			<span class="nrm">		$scope.Todos.remove(&quot;Todo 1&quot;)</span>
			<span class="nrm">		expect($scope.todos).toEqual([&quot;Todo 2&quot;], &quot;One todo left.&quot;)</span>
			<span class="nrm"></span>
			<span class="nfo">@@ -33,6 +35,7 @@</span> describe &quot;todo controller&quot;, -&gt;
			<span class="nrm">		it &quot;saves to local storage&quot;, -&gt;</span>
			<span class="nrm">			$scope.Todos.current = &quot;Todo 1&quot;</span>
			<span class="nrm">			$scope.Todos.add()</span>
			<span class="add">+			$scope.$digest()</span>
			<span class="nrm">			expect(window.localStorage['TDD-ToDos']).toBeDefined(&quot;TDD-ToDos were created on localStorage&quot;)</span>
			<span class="nrm">			stored = window.localStorage['TDD-ToDos']</span>
			<span class="nrm">			expect(stored).toEqual('[&quot;Todo 1&quot;]', &quot;Saves array of todos&quot;)</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash"><a href="https://github.com/DavidSouther/tdd-angular/tree/d3233ce">d3233ce</a></span>  Added animations to checkmarks.</h3>

		<pre>
			<span class="nrm">src/client/todo/style.less    | 10 </span><span class="add">+++++++++</span><span class="rem">-</span>
			<span class="nrm">src/client/todo/template.jade |  2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">2 files changed, 10 insertions(+), 2 deletions(-)</span>
		</pre>

		<p>Some quick animations to spice things up, and the app's a minimal viable product!</p>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/style.less b/src/client/todo/style.less</span>
			<span class="nfo">@@ -7,4 +7,12 @@</span>
			<span class="nrm">
			<span class="nrm">.remove {</span>
			<span class="nrm">	margin-top: 2px;</span>
			<span class="rem">-}</span>
			<span class="nrm">\ No newline at end of file</span>
			<span class="add">+	opacity: 0;</span>
			<span class="add">+	transition: all 0.3s;</span>
			<span class="add">+}</span>
			<span class="add">+</span>
			<span class="add">+.todo:hover {</span>
			<span class="add">+	.remove {</span>
			<span class="add">+		opacity: 1;</span>
			<span class="add">+	}</span>
			<span class="add">+}</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/template.jade b/src/client/todo/template.jade</span>
			<span class="nfo">@@ -5,7 +5,7 @@</span> section.row(ng:controller='todo')
			<span class="nrm">		form(ng:submit='Todos.add()')</span>
			<span class="nrm">			input(type='text', id=&quot;to-do&quot;, name='to-do', placeholder='to-do', ng:model='Todos.current')</span>
			<span class="nrm">		ol(ng:cloak)</span>
			<span class="rem">-			li(ng:repeat='todo in todos')</span>
			<span class="add">+			li.todo(ng:repeat='todo in todos')</span>
			<span class="nrm">				| {{todo}}</span>
			<span class="nrm">				button.remove.btn.btn-default.btn-sm.pull-right(ng:click=&quot;Todos.remove(todo)&quot;)</span>
			<span class="nrm">					span.glyphicon.glyphicon-ok</span>
			<span class="nrm">\ No newline at end of file</span>
		</pre>

		<h2><a href="40_deploy.html">Product: Launch!</a></h2>
	</div>

</div></div></div>
</body>
</html>
