<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="scripts.js"></script>
</head>

<body>
<div class="container"><div class="row"><div class="col-md-8 col-md-offset-2">
	<h1><a href="http://www.obeythetestinggoat.com/">Obey the Testing Goat</a> <small><a href="https://github.com/DavidSouther/tdd-angular">NodeJS edition!</a></small></h1>

	<h2>Continuous Deployment</h2>

	<p class="lead">The app has functionality, and it looks pretty nice. Not the most stylish design, but a certain minimalist design aesthetic. Time to make it public!</p>

	<div class="commit">
		<h3><span class="hash">c1cc8fa</span>  Recursive gruntfiles</h3>

		<pre>
			<span class="nrm">Gruntfile.coffee              | 145 </span><span class="add">+++</span><span class="rem">---------------------------------------</span>
			<span class="nrm">recurse.coffee                |  20 </span><span class="add">++++++</span>
			<span class="nrm">src/client/Gruntfile.coffee   |  74 </span><span class="add">+++++++++++++++++++++</span>
			<span class="nrm">src/features/Gruntfile.coffee |   9 </span><span class="add">+++</span>
			<span class="nrm">src/server/Gruntfile.coffee   |  59 </span><span class="add">+++++++++++++++++</span>
			<span class="nrm">5 files changed, 172 insertions(+), 135 deletions(-)</span>
		</pre>

		<p>First, I want to refactor the Gruntfile. It was getting long and onerous to work with, so I'm using a couple small helper functions to tell Grunt to recurse and let the several modules configure grunt for themselves. The configurations haven't changed, so I've snipped most of the diffs.</p>

		<pre>
			<span class="wrn">diff --git a/Gruntfile.coffee b/Gruntfile.coffee</span>
			<span class="nfo">@@ -1,103 +1,10 @@</span>
			<span class="nrm">module.exports = (grunt)-&gt;</span>
			<span class="rem">-	grunt.initConfig</span>
			<span class="com">[...]</span>
			<span class="add">+	require(&quot;./recurse&quot;)(grunt)</span>
			<span class="com">[...]</span>
			<span class="add">+	grunt.NpmTasks = [ &quot;grunt-contrib-watch&quot; ]</span>
			<span class="com">[...]</span>
			<span class="rem">-	grunt.loadNpmTasks npmTask for npmTask in grunt.npmTasks</span>
			<span class="com">[...]</span>
			<span class="add">+	grunt.initConfig grunt.Config</span>
			<span class="add">+	grunt.loadNpmTasks npmTask for npmTask in grunt.NpmTasks</span>
			<span class="nrm"></span>
			<span class="nrm">grunt.registerTask &quot;test&quot;, [</span>
			<span class="nrm">		&quot;mochaTest:server&quot;</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/recurse.coffee b/recurse.coffee</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,20 @@</span>
			<span class="add">+module.exports = (grunt)-&gt;</span>
			<span class="add">+	grunt.grunt = (path)-&gt;</span>
			<span class="add">+		other = require &quot;#{path}/Gruntfile&quot;</span>
			<span class="add">+		other(grunt)</span>
			<span class="add">+</span>
			<span class="add">+	Object.defineProperty grunt, &quot;Config&quot;, do-&gt;</span>
			<span class="add">+		_config = {}</span>
			<span class="add">+		get: -&gt; _config</span>
			<span class="add">+		set: (val)-&gt;</span>
			<span class="add">+			for t, c of val</span>
			<span class="add">+				_config[t] = _config[t] || {}</span>
			<span class="add">+				for k, v of c</span>
			<span class="add">+					_config[t][k] = v</span>
			<span class="add">+			grunt</span>
			<span class="add">+</span>
			<span class="add">+	Object.defineProperty grunt, &quot;NpmTasks&quot;, do-&gt;</span>
			<span class="add">+		_tasks = []</span>
			<span class="add">+		get: -&gt; _tasks</span>
			<span class="add">+		set: (val)-&gt;</span>
			<span class="add">+			_tasks = _tasks.concat val</span>
		</pre>

		<p>Now, the components (client, server, features) can define their own tasks. The root default task only needs to know the outermost tasks they define to call.</p>

		<pre>
			<span class="wrn">diff --git a/src/server/Gruntfile.coffee b/src/server/Gruntfile.coffee</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,59 @@</span>
			<span class="add">+module.exports = (grunt)-&gt;</span>
			<span class="add">+	grunt.Config =</span>
			<span class="add">+		shell:</span>
			<span class="add">+			kill:</span>
			<span class="add">+				command: &quot;lsof -i TCP -P | grep 4444 | awk '{print $2}' | xargs -I{} kill {} &gt;/dev/null  || exit 0&quot;</span>
			<span class="add">+			install:</span>
			<span class="add">+				command: &quot;[ -f ./selenium/selenium-server-standalone-2.34.0.jar ] || ./node_modules/protractor/bin/install_selenium_standalone&quot;</span>
			<span class="add">+			selenium:</span>
			<span class="add">+				command: [</span>
			<span class="add">+					&quot;java -jar ./selenium/selenium-server-standalone-2.34.0.jar&quot;</span>
			<span class="add">+					&quot;-Dwebdriver.chrome.driver=./selenium/chromedriver&quot;</span>
			<span class="add">+					&quot;&gt;/dev/null&quot;</span>
			<span class="add">+				].join ' '</span>
			<span class="add">+				options:</span>
			<span class="add">+					async: true</span>
			<span class="add">+					kill: true</span>
			<span class="add">+			sleep:</span>
			<span class="add">+				command:</span>
			<span class="add">+					&quot;sleep 1&quot;</span>
			<span class="add">+</span>
			<span class="add">+		cucumberjs:</span>
			<span class="add">+			all:</span>
			<span class="add">+				files:</span>
			<span class="add">+					src: ['src/features/behavior/users/*']</span>
			<span class="add">+			current:</span>
			<span class="add">+				files:</span>
			<span class="add">+					src: ['src/features/behavior/users/*']</span>
			<span class="add">+				options:</span>
			<span class="add">+					tags: '@current'</span>
			<span class="add">+</span>
			<span class="add">+			options:</span>
			<span class="add">+				steps: 'src/features/behavior/steps'</span>
			<span class="add">+</span>
			<span class="add">+	grunt.NpmTasks = [</span>
			<span class="add">+		&quot;grunt-cucumber&quot;</span>
			<span class="add">+		&quot;grunt-shell-spawn&quot;</span>
			<span class="add">+	]</span>
			<span class="add">+</span>
			<span class="add">+	grunt.registerTask &quot;features&quot;, [</span>
			<span class="add">+		&quot;shell:kill&quot; # Clean up any old selenium servers, or other programs who may be hogging 4444</span>
			<span class="add">+		&quot;shell:install&quot;</span>
			<span class="add">+		&quot;shell:selenium&quot;</span>
			<span class="add">+		&quot;shell:sleep&quot;</span>
			<span class="add">+		&quot;cucumberjs:all&quot;</span>
			<span class="add">+		&quot;shell:selenium:kill&quot;</span>
			<span class="add">+		&quot;shell:kill&quot; # Also has the effect of killing driven browsers.</span>
			<span class="add">+	]</span>
			<span class="add">+</span>
			<span class="add">+	grunt.registerTask &quot;feature&quot;, [</span>
			<span class="add">+		&quot;shell:kill&quot; # Clean up any old selenium servers, or other programs who may be hogging 4444</span>
			<span class="add">+		&quot;shell:install&quot;</span>
			<span class="add">+		&quot;shell:selenium&quot;</span>
			<span class="add">+		# Start the application server</span>
			<span class="add">+		&quot;shell:sleep&quot;</span>
			<span class="add">+		&quot;cucumberjs:current&quot;</span>
			<span class="add">+		# Stop the application server</span>
			<span class="add">+		&quot;shell:selenium:kill&quot;</span>
			<span class="add">+		&quot;shell:kill&quot; # Also has the effect of killing driven browsers.</span>
			<span class="add">+	]</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash">b236317</span>  Ready for Heroku</h3>

		<pre>
			<span class="nrm">Gruntfile.coffee |  2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">Procfile         |  1 </span><span class="add">+</span>
			<span class="nrm">package.json     | 14 </span><span class="add">++++++++++</span><span class="rem">----</span>
			<span class="nrm">3 files changed, 12 insertions(+), 5 deletions(-)</span>
		</pre>

		<p>With that, it's time to publish! We'll be using Heroku, because a) I wanted to play around with a PaaS service, and b) I don't like Nodejitsu's pricing structure. Deploying to Heroku should be as easy as creating a Procfile...</p>

		<pre>
			<span class="wrn">diff --git a/Procfile b/Procfile</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1 @@</span>
			<span class="add">+web: npm start</span>
			<span class="nrm">\ No newline at end of file</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash">cb45d32</span>  Configured better for Heroku</h3>

		<pre>
			<span class="nrm">Procfile                    | 2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">package.json                | 5 </span><span class="add">+++</span><span class="rem">--</span>
			<span class="nrm">src/server/server.coffee    | 4 </span><span class="add">++</span><span class="rem">--</span>
			<span class="nrm">src/server/test/port.coffee | 4 </span><span class="add">++</span><span class="rem">--</span>
			<span class="nrm">start.js                    | 2 </span><span class="add">++</span>
			<span class="nrm">5 files changed, 10 insertions(+), 7 deletions(-)</span>
		</pre>

		<p>And it almost was! Sadly, no npm is available in the npm scripts... so a quick rewrite to usde node instead of npm. Also using <code>PORT</code> instead of <code>port</code>.</p>

		<pre>
			<span class="wrn">diff --git a/Procfile b/Procfile</span>
			<span class="nfo">@@ -1 +1 @@</span>
			<span class="rem">-web: npm start</span>
			<span class="add">+web: node start.js</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/start.js b/start.js</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,2 @@</span>
			<span class="add">+require(&quot;coffee-script&quot;);</span>
			<span class="add">+require(&quot;./src/server/server&quot;).serve();</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/server/server.coffee b/src/server/server.coffee</span>
			<span class="nfo">@@ -7,7 +7,7 @@</span> nconf.argv()
			<span class="nrm">	.file</span>
			<span class="nrm">		file: path.join root, 'server.json'</span>
			<span class="nrm">	.defaults</span>
			<span class="rem">-		port: 3000</span>
			<span class="add">+		PORT: 3000</span>
			<span class="nrm"></span>
			<span class="nrm">express = require &quot;express&quot;</span>
			<span class="nrm">app =</span>
			<span class="nfo">@@ -33,7 +33,7 @@</span> app =
			<span class="nrm">module.exports = do -&gt;</span>
			<span class="nrm">	server = null</span>
			<span class="nrm">	serve: -&gt;</span>
			<span class="rem">-		port = nconf.get('port')</span>
			<span class="add">+		port = nconf.get('PORT')</span>
			<span class="nrm">		server = app.listen port</span>
			<span class="nrm">		console.log &quot;ToDo Application Server listening on port #{port}&quot;</span>
			<span class="nrm">	stop: -&gt;</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/server/test/port.coffee b/src/server/test/port.coffee</span>
			<span class="nfo">@@ -20,12 +20,12 @@</span> describe &quot;Server&quot;, -&gt;
			<span class="nrm"></span>
			<span class="nrm">before -&gt;</span>
			<span class="nrm">		_port = nconf.get &quot;port&quot;</span>
			<span class="rem">-		nconf.set &quot;port&quot;, 3030</span>
			<span class="add">+		nconf.set &quot;PORT&quot;, 3030</span>
			<span class="nrm">		server.serve()</span>
			<span class="nrm"></span>
			<span class="nrm">after -&gt;</span>
			<span class="nrm">		server.stop()</span>
			<span class="rem">-		nconf.set &quot;port&quot;, _port</span>
			<span class="add">+		nconf.set &quot;PORT&quot;, _port</span>
			<span class="nrm">		_port = undefined</span>
			<span class="nrm"></span>
			<span class="nrm">describe &quot;/&quot;, -&gt;</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash">f56a1b1</span>  Basic heroku release scripts.</h3>

		<pre>
			<span class="nrm">package.json               | 19 </span><span class="add">+++++++++</span><span class="rem">----------</span>
			<span class="nrm">src/client/todo/style.less |  3 </span><span class="add">++</span><span class="rem">-</span>
			<span class="nrm">src/deploy/install.js      |  1 </span><span class="rem">-</span>
			<span class="nrm">src/deploy/release.sh      | 34 </span><span class="add">++++++++++++++++++++++++++++++++++</span>
			<span class="nrm">4 files changed, 45 insertions(+), 12 deletions(-)</span>
		</pre>

		<p>This deploy script really doesn't work that well... it will go away.</p>

		<pre>
			<span class="wrn">diff --git a/src/deploy/release.sh b/src/deploy/release.sh</span>
			<span class="wrn">new file mode 100755</span>
			<span class="nfo">@@ -0,0 +1,34 @@</span>
			<span class="add">+#/bin/sh</span>
			<span class="add">+</span>
			<span class="add">+function fin(){</span>
			<span class="add">+	echo &quot;Cleaning up&quot;</span>
			<span class="add">+	git co develop</span>
			<span class="add">+	git stash pop</span>
			<span class="add">+</span><span class="reverse"><span class="hash">	</span>
			<span class="add">+	# Fix bower</span>
			<span class="add">+	rm -rf bower_components</span>
			<span class="add">+	bower install</span>
			<span class="add">+}</span>
			<span class="add">+</span>
			<span class="add">+git stash</span>
			<span class="add">+git co master</span>
			<span class="add">+git reset --hard develop</span>
			<span class="add">+</span>
			<span class="add">+if grunt base</span>
			<span class="add">+then</span>
			<span class="add">+	echo &quot;Cutting release and pushing to heroku.&quot;</span>
			<span class="add">+	echo -n</span>
			<span class="add">+else</span>
			<span class="add">+	echo &quot;Cowardly not pushing with failing base build.&quot;</span>
			<span class="add">+	fin</span>
			<span class="add">+	exit 1</span>
			<span class="add">+fi</span>
			<span class="add">+</span>
			<span class="add">+git add --force build</span>
			<span class="add">+git add --force bower_components/angular/angular.js</span>
			<span class="add">+git add --force bower_components/bootstrap/fonts</span>
			<span class="add">+</span>
			<span class="add">+git commit -m 'Release'</span>
			<span class="add">+git push -f heroku master</span>
			<span class="add">+</span>
			<span class="add">+fin</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash">4b587ae</span>  Added sexier animations.</h3>

		<pre>
			<span class="nrm">bower.json                    |  2 </span><span class="rem">--</span>
			<span class="nrm">src/client/Gruntfile.coffee   |  5 </span><span class="add">+++</span><span class="rem">--</span>
			<span class="nrm">src/client/index.jade         |  6 </span><span class="add">++++</span><span class="rem">--</span>
			<span class="nrm">src/client/lib/mixins.less    | 13 </span><span class="add">+++++++++++++</span>
			<span class="nrm">src/client/page.less          |  4 </span><span class="add">++</span><span class="rem">--</span>
			<span class="nrm">src/client/todo/module.coffee | 12 </span><span class="add">++++++</span><span class="rem">------</span>
			<span class="nrm">src/client/todo/style.less    | 39 </span><span class="add">+++++++++++++++++++++++++++++++</span><span class="rem">--------</span>
			<span class="nrm">src/client/todo/template.jade |  2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">src/server/test/serves.coffee |  6 </span><span class="rem">------</span>
			<span class="nrm">9 files changed, 60 insertions(+), 29 deletions(-)</span>
		</pre>

		<p>A brief interlude, wherein the animations become sexy. Upgrading to Angluar 1.2 is necessary. Don't use the 1.1.5 animation docs.</p>

		<pre>
			<span class="wrn">diff --git a/src/client/Gruntfile.coffee b/src/client/Gruntfile.coffee</span>
			<span class="nfo">@@ -35,8 +35,9 @@</span> module.exports = (grunt)-&gt;
			<span class="nrm">					]</span>
			<span class="nrm">					singleRun: true</span>
			<span class="nrm">					files: [</span>
			<span class="rem">-						&quot;bower_components/angular/angular.js&quot;</span>
			<span class="rem">-						&quot;bower_components/angular-mocks/angular-mocks.js&quot;</span>
			<span class="add">+						&quot;http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular.min.js&quot;</span>
			<span class="add">+						&quot;http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular-animate.js&quot;</span>
			<span class="add">+						&quot;http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular-mocks.js&quot;</span>
			<span class="nrm">						&quot;build/bundle.js&quot;</span>
			<span class="nrm">						&quot;src/client/**/unit.coffee&quot;</span>
			<span class="nrm">					]</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/index.jade b/src/client/index.jade</span>
			<span class="nfo">@@ -4,11 +4,13 @@</span> html
			<span class="nrm">		title To Do - Angular JS</span>
			<span class="nrm">		meta(name=&quot;viewport&quot;, content=&quot;width=device-width, initial-scale=1.0&quot;)</span>
			<span class="nrm">		link(rel=&quot;stylesheet&quot;, href=&quot;page.css&quot;, media=&quot;screen&quot;)</span>
			<span class="rem">-		script(src='bower/angular/angular.js')</span>
			<span class="add">+		//- script(src='bower/angular/angular.js')</span>
			<span class="add">+		script(src='//ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular.js')</span>
			<span class="add">+		script(src='//ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular-animate.js')</span>
			<span class="nrm">		script(src='bundle.js')</span>
			<span class="nrm">	body(ng:app='todo')</span>
			<span class="nrm">		.container</span>
			<span class="rem">-			.jumbotron</span>
			<span class="add">+			.jumbotron.well</span>
			<span class="nrm">				include todo/template</span>
			<span class="nrm">			footer</span>
			<span class="nrm">				:markdown</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/lib/mixins.less b/src/client/lib/mixins.less</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,13 @@</span>
			<span class="add">+.transition (@transition) {</span>
			<span class="add">+	-webkit-transition: @transition;</span><span class="reverse"><span class="hash">  </span>
			<span class="add">+	-moz-transition:    @transition;</span>
			<span class="add">+	-ms-transition:     @transition;</span><span class="reverse"><span class="hash"> </span>
			<span class="add">+	-o-transition:      @transition;</span><span class="reverse"><span class="hash">  </span>
			<span class="add">+}</span>
			<span class="add">+</span>
			<span class="add">+.rotate (@deg) {</span>
			<span class="add">+	-webkit-transform: rotate(@deg);</span>
			<span class="add">+	-moz-transform: 	 rotate(@deg);</span>
			<span class="add">+	-ms-transform: 		 rotate(@deg);</span>
			<span class="add">+	-o-transform: 		 rotate(@deg);</span>
			<span class="add">+}</span>
			<span class="nrm">\ No newline at end of file</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/page.less b/src/client/page.less</span>
			<span class="nfo">@@ -1,3 +1,3 @@</span>
			<span class="nrm">@import &quot;bootstrap.less&quot;;</span>
			<span class="rem">-</span>
			<span class="rem">-@import &quot;./todo/style.less&quot;;</span>
			<span class="nrm">\ No newline at end of file</span>
			<span class="add">+@import &quot;./lib/mixins.less&quot;;</span>
			<span class="add">+@import &quot;./todo/style.less&quot;;</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/module.coffee b/src/client/todo/module.coffee</span>
			<span class="nfo">@@ -1,18 +1,18 @@</span>
			<span class="rem">-module.exports = todo = angular.module &quot;todo&quot;, []</span>
			<span class="add">+module.exports = todo = angular.module &quot;todo&quot;, ['ngAnimate']</span>
			<span class="nrm">todo.service &quot;storage&quot;, -&gt;</span>
			<span class="nrm">	get: -&gt; JSON.parse window.localStorage[&quot;TDD-ToDos&quot;] || '[]'</span>
			<span class="rem">-	put: (TDs)-&gt; window.localStorage[&quot;TDD-ToDos&quot;] = JSON.stringify TDs</span>
			<span class="add">+	put: (TDs)-&gt; window.localStorage[&quot;TDD-ToDos&quot;] = JSON.stringify TDs || []</span>
			<span class="nrm">todo.controller &quot;todo&quot;, ($scope, storage)-&gt;</span>
			<span class="rem">-	todos = $scope.todos = storage.get()</span>
			<span class="add">+	$scope.todos = storage.get()</span>
			<span class="nrm">	save = (newV, oldV) -&gt;</span>
			<span class="rem">-		storage.put todos</span>
			<span class="add">+		storage.put $scope.todos</span>
			<span class="nrm">	$scope.$watch 'todos', save, true</span>
			<span class="nrm">	Todos = $scope.Todos =</span>
			<span class="nrm">		current: &quot;&quot;</span>
			<span class="nrm">		add: -&gt;</span>
			<span class="rem">-			todos.push Todos.current</span>
			<span class="add">+			$scope.todos.push Todos.current</span>
			<span class="nrm">			Todos.current = &quot;&quot;</span>
			<span class="nrm">		remove: (todo)-&gt;</span>
			<span class="rem">-			todos.splice todos.indexOf(todo), 1</span>
			<span class="add">+			$scope.todos.splice $scope.todos.indexOf(todo), 1</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/client/todo/style.less b/src/client/todo/style.less</span>
			<span class="nfo">@@ -5,15 +5,38 @@</span>
			<span class="nrm"> width: 100%;</span>
			<span class="rem">-.remove {</span>
			<span class="rem">-	margin-top: 2px;</span>
			<span class="rem">-	opacity: 0;</span>
			<span class="rem">-	transition: all 0.3s 0.2s;</span>
			<span class="rem">-}</span>
			<span class="rem">-</span>
			<span class="rem">-.todo:hover {</span>
			<span class="add">+.todo {</span>
			<span class="nrm">	.remove {</span>
			<span class="add">+		margin-top: 2px;</span>
			<span class="add">+		opacity: 0;</span>
			<span class="add">+		.transition(all 0.1s ease 0s);</span>
			<span class="add">+	}</span>
			<span class="add">+	&amp;:hover {</span>
			<span class="add">+		.remove {</span>
			<span class="add">+			opacity: 1;</span>
			<span class="add">+			.transition(all 0.3s ease 0.2s);</span>
			<span class="add">+		}</span>
			<span class="add">+	}</span>
			<span class="add">+</span>
			<span class="add">+	// Enter and exit animations</span>
			<span class="add">+	// Smooth fade in from slight angle</span>
			<span class="add">+	&amp;.ng-enter { .transition(all 0.5s ease); }</span>
			<span class="add">+	&amp;.ng-leave { .transition(all 0.2s ease); }</span>
			<span class="add">+	&amp;.ng-leave {</span>
			<span class="add">+		.remove {</span>
			<span class="add">+			display: none;</span>
			<span class="add">+		}</span>
			<span class="add">+	}</span>
			<span class="add">+</span>
			<span class="add">+	&amp;.ng-enter,</span>
			<span class="add">+	&amp;.ng-leave.ng-leave-active {</span>
			<span class="add">+		opacity: 0;</span>
			<span class="add">+		.rotate(6deg);</span>
			<span class="add">+	}</span>
			<span class="add">+</span>
			<span class="add">+	&amp;.ng-enter.ng-enter-active,</span>
			<span class="add">+	&amp;.ng-leave {</span>
			<span class="nrm">		opacity: 1;</span>
			<span class="rem">-		transition: all 0.1s 0;</span>
			<span class="add">+		.rotate(0);</span>
			<span class="nrm">	}</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash">715893a</span>  Feature tests run against heroku.</h3>

		<pre>
			<span class="nrm">src/deploy/release.sh                              |  7 </span><span class="add">+++</span>
			<span class="nrm">src/features/Gruntfile.coffee                      | 69 </span><span class="add">++++++++++++++++++++</span><span class="rem">--</span>
			<span class="nrm">src/features/behavior/steps/browsing.coffee        | 11 </span><span class="add">++</span><span class="rem">--</span>
			<span class="nrm">.../behavior/support/worlds/protractor.coffee      |  2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">src/server/Gruntfile.coffee                        | 62 </span><span class="add">++</span><span class="rem">-----------------</span>
			<span class="nrm">5 files changed, 84 insertions(+), 67 deletions(-)</span>
		</pre>

		<p>Another deploy, and time to run those feature tests against the whole stack!</p>

		<pre>
			<span class="wrn">diff --git a/src/deploy/release.sh b/src/deploy/release.sh</span>
			<span class="nfo">@@ -29,6 +29,13 @@</span> git add --force bower_components/angular/angular.js
			<span class="nrm">git add --force bower_components/bootstrap/fonts</span>
			<span class="nrm">git commit -m 'Release'</span>
			<span class="add">+</span>
			<span class="add">+echo &quot;Files in release:&quot;</span>
			<span class="add">+git ls-files</span>
			<span class="add">+</span>
			<span class="nrm">git push -f heroku master</span>

			<span class="add">+# Test against heroku</span>
			<span class="add">+SERVER=$(heroku apps:info | grep 'Web URL' | awk '{print $3}') grunt features</span>
			<span class="add">+</span>
			<span class="nrm">fin</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/features/behavior/steps/browsing.coffee b/src/features/behavior/steps/browsing.coffee</span>
			<span class="nfo">@@ -1,26 +1,29 @@</span>
			<span class="nrm">Q = require 'q'</span>
			<span class="nrm">should = require &quot;should&quot;</span>
			<span class="add">+</span>
			<span class="add">+server = process.env.SERVER || &quot;http://localhost:3000/&quot;</span>
			<span class="add">+</span>
			<span class="nrm">module.exports = -&gt;</span>
			<span class="nrm">	@Given /has (?:his|her|a) browser open$/, (done)-&gt;</span>
			<span class="nrm">		done()</span>
			<span class="nrm"></span>
			<span class="nrm">@Given /has entered a &quot;([^&quot;]*)&quot; item/, (value, done)-&gt;</span>
			<span class="rem">-		@world.visit(&quot;http://localhost:3000/&quot;)</span>
			<span class="add">+		@world.visit(server)</span>
			<span class="nrm">		.then(=&gt;@world.fill(value, value, true))</span>
			<span class="nrm">		.then(=&gt;done())</span>
			<span class="nrm">		.catch(done)</span>
			<span class="nrm"></span>
			<span class="nrm">@Given /(?:on|goes to|visits) the (?:site|landing page)(?: directly)?/, (done)-&gt;</span>
			<span class="rem">-		@world.visit(&quot;http://localhost:3000/&quot;)</span>
			<span class="add">+		@world.visit(server)</span>
			<span class="nrm">		.then(done)</span>
			<span class="nrm"></span>
			<span class="nrm">@When /goes to the &quot;([^&quot;]*)&quot; url/, (url, done)-&gt;</span>
			<span class="rem">-		@world.visit(&quot;http://localhost:3000/&quot;)</span>
			<span class="add">+		@world.visit(server)</span>
			<span class="nrm">		.then(done)</span>
			<span class="nrm"></span>
			<span class="nrm">@Given /leaves the page/, (done)-&gt;</span>
			<span class="nrm">		# @world.reload()</span>
			<span class="rem">-		@world.visit(&quot;http://localhost:3000/&quot;)</span>
			<span class="add">+		@world.visit(server)</span>
			<span class="nrm">		.then -&gt;done()</span>
			<span class="nrm"></span>
			<span class="nrm">@When /enters &quot;([^&quot;]+)&quot; into (?:the|a) &quot;([^&quot;]+)&quot; (?:box|input|field)/, (value, field, done)-&gt;</span>
		</pre>

		<p>Really just switch to using <code>process.env</code> instead of hardcoded URIs.</p>
	</div>

	<div class="commit">
		<h3><span class="hash">41ed5d7</span>  Added travis config.</h3>

		<pre>
			<span class="nrm">.travis.yml        | 7 </span><span class="add">+++++++</span>
			<span class="nrm">package.json       | 2 </span><span class="add">+</span><span class="rem">-</span>
			<span class="nrm">src/deploy/test.js | 1 </span><span class="add">+</span>
			<span class="nrm">3 files changed, 9 insertions(+), 1 deletion(-)</span>
		</pre>

		<p>We have automated testing. Let's add continuous integration. Travis is a CI tool that ties in to Github, and is free for open source projects.</p>

		<pre>
			<span class="wrn">diff --git a/.travis.yml b/.travis.yml</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1,7 @@</span>
			<span class="add">+language: node_js</span>
			<span class="add">+node_js:</span>
			<span class="add">+  - &quot;0.10&quot;</span>
			<span class="add">+</span>
			<span class="add">+before_install:</span>
			<span class="add">+  - &quot;export DISPLAY=:99.0&quot;</span>
			<span class="add">+  - &quot;sh -e /etc/init.d/xvfb start&quot;</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/package.json b/package.json</span>
			<span class="nfo">@@ -5,7 +5,7 @@</span>
			<span class="nrm">&quot;main&quot;: &quot;index.js&quot;,</span>
			<span class="nrm">&quot;scripts&quot;: {</span>
			<span class="nrm"> &quot;postinstall&quot;: &quot;node src/deploy/install.js&quot;,</span>
			<span class="rem">-    &quot;test&quot;: &quot;grunt test&quot;,</span>
			<span class="add">+    &quot;test&quot;: &quot;node src/deploy/test.js&quot;,</span>
			<span class="nrm"> &quot;start&quot;: &quot;node src/deploy/start.js&quot;</span>
			<span class="nrm">},</span>
			<span class="nrm">&quot;author&quot;: &quot;David Souther&quot;,</span>
		</pre>

		<pre>
			<span class="wrn">diff --git a/src/deploy/test.js b/src/deploy/test.js</span>
			<span class="wrn">new file mode 100644</span>
			<span class="nfo">@@ -0,0 +1 @@</span>
			<span class="add">+require(&quot;grunt&quot;).tasks(&quot;base&quot;);</span>
		</pre>
	</div>

	<div class="commit">
		<h3><span class="hash">3b228d6</span>  Added heroku deploy config.</h3>

		<pre>
			<span class="nrm">.travis.yml | 14 </span><span class="add">++++++++++</span><span class="rem">----</span>
			<span class="nrm">1 file changed, 10 insertions(+), 4 deletions(-)</span>
		</pre>

		<p>With this last change, we can have Travis deploy to Heroku on successful build... and move us toward getting rid of the hacky deploy.sh script.</p>

		<pre>
			<span class="wrn">diff --git a/.travis.yml b/.travis.yml</span>
			<span class="nfo">@@ -1,7 +1,13 @@</span>
			<span class="nrm">language: node_js</span>
			<span class="nrm">node_js:</span>
			<span class="rem">-  - &quot;0.10&quot;</span>
			<span class="rem">-</span>
			<span class="add">+- '0.10'</span>
			<span class="nrm">before_install:</span>
			<span class="rem">-  - &quot;export DISPLAY=:99.0&quot;</span>
			<span class="rem">-  - &quot;sh -e /etc/init.d/xvfb start&quot;</span>
			<span class="add">+- export DISPLAY=:99.0</span>
			<span class="add">+- sh -e /etc/init.d/xvfb start</span>
			<span class="add">+deploy:</span>
			<span class="add">+  provider: heroku</span>
			<span class="add">+  api_key:</span>
			<span class="add">+    secure: cGrIXz0ZwnshOnasByfakIdtum9Sbef5RCRYaN2h/ovAzCyDty/+pOp6DOu/OvJrzyRs4EngO4scThLwwceT/bnzbBudWasvSQIkmcI8kILpJpwWFJ1Wn8oRM5x1euhrB7uBSDY3TvneAeZWPx/eJLm2fQpw5c1xonVyuzChBfc=</span>
			<span class="add">+  app: afternoon-savannah-7174</span>
			<span class="add">+  on:</span>
			<span class="add">+    repo: DavidSouther/tdd-angular</span>
		</pre>
	</div>

</div></div></div>
</body>
</html>
